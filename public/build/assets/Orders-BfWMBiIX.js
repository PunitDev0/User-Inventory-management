import{r as a,j as e,a as N}from"./app-CnuuUVAv.js";import{L as k}from"./Layout-CZWFnRXh.js";import{B as x}from"./index-Fdi4hGc0.js";import{I as P}from"./input-BAMlnd9k.js";import{T as z,a as I,b as g,c as r,d as E,e as n}from"./table-B9ACykM8.js";import{D as Q,a as B,b as H,c as R,d as $}from"./dialog-BeYZtdij.js";import{y as p}from"./index-B21byFpd.js";/* empty css                      */import{I as u}from"./indian-rupee-BpsN2FII.js";import"./index-9eWm-de7.js";import"./index-C1K0-1mr.js";function q(){const[_,j]=a.useState([]),[h,v]=a.useState(""),[w,C]=a.useState(!0),[y,S]=a.useState(null),[i,O]=a.useState(null),[A,c]=a.useState(!1),[d,b]=a.useState("");a.useEffect(()=>{(async()=>{try{const t=await N.get("/userorders");j(t.data.orders||[])}catch(t){console.error("Error fetching orders:",t),S("Failed to fetch orders. Please try again later.")}finally{C(!1)}})()},[]);const m=_.filter(s=>s.user_name.toLowerCase().includes(h.toLowerCase())||s.products.product_name.toLowerCase().includes(h.toLowerCase()));if(w)return e.jsx("div",{children:"Loading..."});if(y)return e.jsx("div",{children:y});const f=s=>{O(s),b(""),c(!0)},T=s=>{const t=s.target.value,l=Number(t);l>=0&&l<=i.pending_payment?b(l):p.error("Amount should not exceed the pending payment.")},D=async()=>{var s,t;if(!i||!d||d<=0){p.error("Please enter a valid payment amount.");return}try{const l=await N.post("/pay-pending-payment",{order_id:i.id,payment_amount:d});p.success("Payment successful!"),j(L=>L.map(o=>o.id===i.id?{...o,pending_payment:String(Number(o.pending_payment)-Number(d))}:o)),c(!1)}catch(l){p.error(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.error)||"Payment failed. Please try again.")}};return e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Your Orders"}),e.jsx("div",{className:"mt-6 flex flex-col sm:flex-row gap-4",children:e.jsx(P,{placeholder:"Search orders...",value:h,onChange:s=>v(s.target.value)})}),e.jsx("div",{className:"mt-4 border rounded-lg hidden lg:block",children:e.jsxs(z,{children:[e.jsx(I,{children:e.jsxs(g,{children:[e.jsx(r,{children:"Order ID"}),e.jsx(r,{children:"Product"}),e.jsx(r,{children:"Quantity"}),e.jsx(r,{children:"Address"}),e.jsx(r,{children:"Total"}),e.jsx(r,{children:"Pending Amount"}),e.jsx(r,{children:"Payment Status"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(E,{children:m.length>0?m.map(s=>e.jsxs(g,{className:"border-b",children:[e.jsx(n,{children:s.id}),e.jsx(n,{children:s.products.product_name}),e.jsx(n,{children:s.quantity}),e.jsxs(n,{children:[s.user_address,", ",s.user_city,", ",s.user_zip]}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{size:15}),s.total_amount]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{size:15}),s.pending_payment]})}),e.jsx(n,{children:Number(s.pending_payment)>0?e.jsx("span",{className:"text-red-500 font-semibold",children:"Pending"}):e.jsx("span",{className:"text-green-500 font-semibold",children:"Paid"})}),e.jsx(n,{children:e.jsx(x,{className:`${Number(s.pending_payment)>0?"bg-red-600":"bg-green-600"} text-white px-3 py-1`,onClick:()=>f(s),disabled:Number(s.pending_payment)<=0,children:Number(s.pending_payment)>0?"Pay Pending":"Paid"})})]},s.id)):e.jsx(g,{children:e.jsx(n,{colSpan:8,className:"text-center py-4",children:"No orders found."})})})]})}),e.jsx("div",{className:"mt-4 flex flex-col gap-4 lg:hidden",children:m.length>0?m.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 shadow-md bg-white",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Order #",s.id]}),e.jsx("span",{className:`px-2 py-1 text-sm font-medium rounded-lg ${Number(s.pending_payment)>0?"bg-red-100 text-red-600":"bg-green-100 text-green-600"}`,children:Number(s.pending_payment)>0?"Pending":"Paid"})]}),e.jsxs("p",{className:"mt-2 text-gray-600",children:[e.jsx("b",{children:"Product:"})," ",s.products.product_name]}),e.jsxs("p",{className:"mt-1 text-gray-600",children:[e.jsx("b",{children:"Quantity:"})," ",s.quantity]}),e.jsxs("p",{className:"mt-1 text-gray-600",children:[e.jsx("b",{children:"Address:"})," ",s.user_address,", ",s.user_city,", ",s.user_zip]}),e.jsxs("p",{className:"mt-1 text-gray-600 flex items-center",children:[e.jsx(u,{size:15}),e.jsx("b",{children:"Total:"})," ",s.total_amount]}),e.jsxs("p",{className:"mt-1 text-gray-600 flex items-center",children:[e.jsx(u,{size:15}),e.jsx("b",{children:"Pending:"})," ",s.pending_payment]}),e.jsx(x,{className:`w-full mt-3 ${Number(s.pending_payment)>0?"bg-red-600":"bg-green-600"} text-white py-2`,onClick:()=>f(s),disabled:Number(s.pending_payment)<=0,children:Number(s.pending_payment)>0?"Pay Pending":"Paid"})]},s.id)):e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No orders found."})}),e.jsx(Q,{open:A,onOpenChange:c,children:e.jsxs(B,{children:[e.jsx(H,{children:e.jsx(R,{children:"Pay Pending Amount"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Amount to Pay"}),e.jsx(P,{className:"mt-2",type:"number",value:d,onChange:T,min:0,max:i==null?void 0:i.pending_payment})]}),e.jsxs($,{children:[e.jsx(x,{className:"bg-red-600 text-white",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{className:"ml-2 bg-green-600 text-white",onClick:D,children:"Pay Now"})]})]})})]})}function ee(){return e.jsx(k,{children:e.jsx(q,{})})}export{ee as default};
