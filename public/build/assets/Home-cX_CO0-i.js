import{j as e,r as x,a as Z}from"./app-BsADHLCK.js";import{S as U,a as I,b as $,c as E,d as u}from"./select-CxXqJpXC.js";import{o as L}from"./orders-DfEdUI4w.js";import{C as N,a as C,d as D,e as A,b as S}from"./card-CYHjdoAt.js";import{i as ee,I as te}from"./index-DLwX_whV.js";import{U as F,W as se,D as f,T as ae,R as M,A as re,C as le,X as ne,Y as de,a as oe,b as B,P as ie,c as ce,d as ge,L as xe}from"./Dashboard-B2hOgUjY.js";import{C as me}from"./circle-check-big-Jwlbtwtn.js";import{C as pe}from"./calendar-DntkvpRE.js";import{L as ue}from"./Layout-Dm-XsKab.js";import"./index-CzDCuHYf.js";import"./input-BgboekYe.js";import"./dialog-CGocLIYP.js";import"./index-DMMY2Vbx.js";import"./index-CNZ3j-SY.js";import"./index-BtRmUPCT.js";const g=({title:a,value:r,description:t,icon:s,colorClass:l,bgClass:d})=>e.jsxs(N,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsxs(C,{className:`${d} p-4 rounded-t-lg`,children:[e.jsxs(D,{className:"flex items-center gap-2 text-gray-800 dark:text-gray-100 text-lg sm:text-xl font-semibold",children:[e.jsx(s,{className:`w-6 h-6 sm:w-7 sm:h-7 ${l}`}),a]}),e.jsx(A,{className:"text-gray-600 dark:text-gray-400 text-sm",children:t})]}),e.jsx(S,{className:"p-4",children:e.jsx("p",{className:`text-3xl sm:text-4xl font-bold ${l} flex items-center`,children:a.includes("Amount")||a.includes("Expenses")||a.includes("Revenue")?e.jsxs(e.Fragment,{children:[e.jsx(te,{size:20,className:"mr-1"})," ",r.toFixed(2)]}):r})})]}),he=({companyOrders:a,filteredOrders:r,successfulPayments:t,totalActualPayAmount:s,totalPaidAmount:l,totalPendingAmount:d,totalExpensesAmount:o,netRevenue:n})=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsx(g,{title:"Total Orders",value:a.length,description:"All company orders",icon:ee,colorClass:"text-indigo-600 dark:text-indigo-400",bgClass:"bg-indigo-50 dark:bg-indigo-900"}),e.jsx(g,{title:"My Orders",value:r.length,description:"Your personal orders",icon:F,colorClass:"text-teal-600 dark:text-teal-400",bgClass:"bg-teal-50 dark:bg-teal-900"}),e.jsx(g,{title:"Paid Orders",value:t.length,description:"Successful payments",icon:me,colorClass:"text-green-600 dark:text-green-400",bgClass:"bg-green-50 dark:bg-green-900"}),e.jsx(g,{title:"Total Order Amount",value:s,description:"Total amount owed",icon:se,colorClass:"text-blue-600 dark:text-blue-400",bgClass:"bg-blue-50 dark:bg-blue-900"}),e.jsx(g,{title:"Total Paid Amount",value:l,description:"Total payments received",icon:f,colorClass:"text-purple-600 dark:text-purple-400",bgClass:"bg-purple-50 dark:bg-purple-900"}),e.jsx(g,{title:"Total Pending Amount",value:d,description:"Total amount pending",icon:f,colorClass:"text-orange-600 dark:text-orange-400",bgClass:"bg-orange-50 dark:bg-orange-900"}),e.jsx(g,{title:"Total Expenses",value:o,description:"All recorded expenses",icon:f,colorClass:"text-red-600 dark:text-red-400",bgClass:"bg-red-50 dark:bg-red-900"}),e.jsx(g,{title:"Net Revenue",value:n,description:"Revenue after expenses",icon:f,colorClass:"text-yellow-600 dark:text-yellow-400",bgClass:"bg-yellow-50 dark:bg-yellow-900"})]}),j=({title:a,data:r,timeRange:t,color:s,gradientId:l,bgClass:d,iconColor:o})=>e.jsxs(N,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsxs(C,{className:`${d} p-4 rounded-t-lg`,children:[e.jsxs(D,{className:"flex items-center gap-2 text-gray-800 dark:text-gray-100 text-lg sm:text-xl font-semibold",children:[e.jsx(ae,{className:`w-6 h-6 sm:w-7 sm:h-7 ${o}`}),a]}),e.jsx(A,{className:"text-gray-600 dark:text-gray-400 text-sm",children:t==="All"?"All time":`Last ${t} days`})]}),e.jsx(S,{className:"p-4 sm:p-6",children:e.jsx(M,{width:"100%",height:300,children:r.length>0?e.jsxs(re,{data:r,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:l,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:s,stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:s,stopOpacity:0})]})}),e.jsx(le,{strokeDasharray:"3 3",stroke:"#e0e0e0",opacity:.5}),e.jsx(ne,{dataKey:"date",stroke:"#666",tick:{fill:"#666",fontSize:12},tickFormatter:n=>t==="All"?n:n.split("-").slice(1).join("-")}),e.jsx(de,{stroke:"#666",tick:{fill:"#666",fontSize:12}}),e.jsx(oe,{type:"monotone",dataKey:"orders",stroke:s,strokeWidth:2,fill:`url(#${l})`,dot:{r:4,fill:s}}),e.jsx(B,{contentStyle:{backgroundColor:"#fff",borderRadius:"6px",border:"1px solid #e0e0e0"},labelStyle:{color:"#333"},itemStyle:{color:s},labelFormatter:n=>`Date: ${n}`,formatter:n=>Math.round(n)})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400 text-sm",children:"No data available for this range"})})})]}),k=["#6b7280","#f97316","#22c55e","#3b82f6","#a855f7"],ye=({top5Users:a,filteredOrders:r,timeRange:t})=>e.jsxs(N,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 col-span-1 lg:col-span-2",children:[e.jsxs(C,{className:"bg-indigo-50 dark:bg-indigo-900 p-4 rounded-t-lg flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs(D,{className:"flex items-center gap-2 text-gray-800 dark:text-gray-100 text-lg sm:text-xl font-semibold",children:[e.jsx(F,{className:"w-6 h-6 sm:w-7 sm:h-7 text-indigo-600 dark:text-indigo-400"}),"Order Distribution (Top 5 Users)"]}),e.jsx(A,{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:t==="All"?"All time":`Last ${t} days`})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 sm:mt-0 bg-indigo-100 dark:bg-indigo-800 px-3 py-1 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Total Orders:"}),e.jsx("span",{className:"text-lg font-bold text-indigo-600 dark:text-indigo-400",children:r.length})]})]}),e.jsx(S,{className:"p-4 sm:p-6",children:e.jsx(M,{width:"100%",height:300,children:a.length>0?e.jsxs(ie,{children:[e.jsx(ce,{data:a,dataKey:"value",nameKey:"name",innerRadius:"50%",outerRadius:"80%",paddingAngle:5,animationDuration:800,animationBegin:100,labelLine:!1,label:({name:s,value:l})=>`${s}: ${l}`,children:a.map((s,l)=>e.jsx(ge,{fill:k[l%k.length]},`cell-${l}`))}),e.jsx(B,{contentStyle:{backgroundColor:"#fff",borderRadius:"6px",border:"1px solid #e0e0e0"},labelStyle:{color:"#333"},formatter:(s,l)=>[`${s} orders`,l]}),e.jsx(xe,{layout:"vertical",verticalAlign:"middle",align:"right",wrapperStyle:{paddingLeft:"20px",fontSize:"14px",color:"#333"},formatter:(s,l)=>e.jsxs("span",{style:{color:k[l.payload.payload.fill?k.indexOf(l.payload.payload.fill):0]},children:[s,": ",l.payload.value]})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400 text-sm",children:"No user data available"})})})]}),be=({orders:a})=>{const[r,t]=x.useState("all"),s=new Date(a[0].delivered_date);console.log("deliver date ",s),console.log(s>new Date);const d=a.filter(n=>{if(!n.delivered_date)return!1;const m=new Date(n.delivered_date),h=new Date;return!isNaN(m.getTime())&&m>h}).sort((n,m)=>new Date(n.delivered_date)-new Date(m.delivered_date));console.log(d);const o=d.filter(n=>{const i=(new Date(n.delivered_date)-new Date)/(1e3*3600*24);return r==="week"?i<=7:r==="month"?i<=30:!0});return e.jsxs(N,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsxs(C,{className:"bg-purple-50 dark:bg-purple-900 p-4 rounded-t-lg flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs(D,{className:"flex items-center gap-2 text-gray-800 dark:text-gray-100 text-lg sm:text-xl font-semibold",children:[e.jsx(pe,{className:"w-6 h-6 sm:w-7 sm:h-7 text-purple-600 dark:text-purple-400"}),"Upcoming Deliveries"]}),e.jsx(A,{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:"Orders scheduled for delivery"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 sm:mt-0",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Filter:"}),e.jsxs(U,{value:r,onValueChange:t,children:[e.jsx(I,{className:"w-[120px] rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100",children:e.jsx($,{placeholder:"All"})}),e.jsxs(E,{className:"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600",children:[e.jsx(u,{value:"all",className:"text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700",children:"All Upcoming"}),e.jsx(u,{value:"week",className:"text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Next 7 Days"}),e.jsx(u,{value:"month",className:"text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Next 30 Days"})]})]})]})]}),e.jsx(S,{className:"p-4 sm:p-6",children:o.length>0?e.jsx("div",{className:"space-y-4 max-h-[300px] overflow-y-auto",children:o.map(n=>e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-100",children:["Order #",n.id," - ",n.user_name||"Unknown"]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Status: ",n.status]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium text-purple-600 dark:text-purple-400",children:[n.delivered_date," "]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[Math.ceil((new Date(n.delivered_date)-new Date)/(1e3*3600*24))," days"]})]})]},n.id))}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500 dark:text-gray-400 text-sm",children:"No upcoming deliveries found"})})]})},fe=a=>{const r=[];for(let t=a-1;t>=0;t--){const s=new Date;s.setDate(s.getDate()-t),r.push(s.toISOString().split("T")[0])}return r},v=(a,r)=>{const t={};return r.forEach(s=>{t[s]=0}),a.forEach(s=>{const l=new Date(s.created_at).toISOString().split("T")[0];t[l]!==void 0&&t[l]++}),r.map(s=>({date:s,orders:t[s]||0}))},je=(a,r)=>{const t=new Date;return a.filter(s=>{const l=new Date(s.created_at);return r==="All"?!0:(t-l)/(1e3*3600*24)<=r})},ke=a=>{const r=a.reduce((t,s)=>{const l=s.user_id||"unknown";return t[l]=(t[l]||0)+1,t},{});return Object.entries(r).sort(([,t],[,s])=>s-t).slice(0,5).map(([t,s])=>({name:t==="unknown"?"Unknown User":`User ${t}`,value:s}))},ve=(a,r)=>{const t=new Set(r.map(s=>s.id.toString()));return a.filter(s=>t.has(s.order_id)).reduce((s,l)=>s+l.expenses.reduce((d,o)=>d+parseFloat(o.amount||0),0),0)},we=a=>a.reduce((r,t)=>r+parseFloat(t.total_amount||0),0),Ne=a=>a.reduce((r,t)=>r+parseFloat(t.paid_payment||0),0),Ce=a=>a.reduce((r,t)=>r+parseFloat(t.pending_payment||0),0),w=a=>{if(a.length===0)return[];const r={};return a.forEach(t=>{const l=new Date(t.created_at).toLocaleString("default",{month:"short",year:"numeric"});r[l]=(r[l]||0)+1}),Object.keys(r).map(t=>({date:t,orders:r[t]}))},De=()=>{const[a,r]=x.useState([]),[t,s]=x.useState([]),[l,d]=x.useState([]),[o,n]=x.useState(null),[m,h]=x.useState(!0),[i,z]=x.useState("All");if(x.useEffect(()=>{(async()=>{try{const[T,J,Q]=await Promise.all([L.getAllOrders(),L.getUserOrders(),Z.get("api/expenses")]);r(T.orders||[]),s(J.orders||[]),d(Q.data.data||[])}catch(T){n("Failed to fetch data. Please try again later."),console.error("Error fetching data:",T)}finally{h(!1)}})()},[]),m)return e.jsx("div",{className:"p-6 text-center",children:"Loading Dashboard..."});if(o)return e.jsx("div",{className:"p-6 text-center text-red-600",children:o});const p=i==="All"?"All":parseInt(i),y=p==="All"?[]:fe(p),c=je(t,p),K=ke(c),P=ve(l,c),W=we(c),R=Ne(c),V=Ce(c),Y=R-P,O=c.filter(b=>b.status==="paid"),_=c.filter(b=>b.status==="pending"),G=p==="All"?w(a):v(a,y),X=p==="All"?w(c):v(c,y),H=p==="All"?w(O):v(O,y),q=p==="All"?w(_):v(_,y);return e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 lg:p-10 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"mb-6 sm:mb-8 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 dark:text-gray-100 tracking-tight",children:"Dashboard"}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Time Range:"}),e.jsxs(U,{value:i,onValueChange:z,children:[e.jsx(I,{className:"w-[140px] sm:w-[150px]",children:e.jsx($,{placeholder:"All Time"})}),e.jsxs(E,{children:[e.jsx(u,{value:"7",children:"Last 7 Days"}),e.jsx(u,{value:"30",children:"Last 30 Days"}),e.jsx(u,{value:"All",children:"All Time"})]})]})]})]}),e.jsx(he,{companyOrders:a,filteredOrders:c,successfulPayments:O,totalActualPayAmount:W,totalPaidAmount:R,totalPendingAmount:V,totalExpensesAmount:P,netRevenue:Y}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsx(j,{title:"Company Orders Trend",data:G,timeRange:i,color:"#0070f3",gradientId:"colorOrders",bgClass:"bg-indigo-50 dark:bg-indigo-900",iconColor:"text-indigo-600 dark:text-indigo-400"}),e.jsx(j,{title:"My Orders Trend",data:X,timeRange:i,color:"#00b894",gradientId:"colorMyOrders",bgClass:"bg-teal-50 dark:bg-teal-900",iconColor:"text-teal-600 dark:text-teal-400"}),e.jsx(j,{title:"Successful Payments Trend",data:H,timeRange:i,color:"#2ecc71",gradientId:"colorSuccess",bgClass:"bg-green-50 dark:bg-green-900",iconColor:"text-green-600 dark:text-green-400"}),e.jsx(j,{title:"Pending Payments Trend",data:q,timeRange:i,color:"#f39c12",gradientId:"colorPending",bgClass:"bg-orange-50 dark:bg-orange-900",iconColor:"text-orange-600 dark:text-orange-400"}),e.jsx(ye,{top5Users:K,filteredOrders:c,timeRange:i}),e.jsx(be,{orders:t})," "]})]})};function ze(){return console.log("API URL:","https://crm.aryanevents.com/user/public"),e.jsx(ue,{children:e.jsx(De,{})})}export{ze as default};
