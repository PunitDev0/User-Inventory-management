import{r as u,j as e,a as z}from"./app-CnuuUVAv.js";import{u as V}from"./index.esm-Ctihm-d5.js";import{P as k}from"./progress-Mq-GDWPi.js";import{I as l}from"./input-BAMlnd9k.js";import{B as D}from"./index-Fdi4hGc0.js";import{C as m,a as f,b as j,c as L}from"./card-DFevLNd8.js";import{L as R,y as P}from"./index-B21byFpd.js";/* empty css                      */import{L as $}from"./Layout-CZWFnRXh.js";import{I as y}from"./indian-rupee-BpsN2FII.js";import"./index-C1K0-1mr.js";import"./index-9eWm-de7.js";function X({cartItems:N}){const{register:r,handleSubmit:C,setValue:w,watch:p,formState:{errors:c},reset:v}=V(),[d,b]=u.useState(N),[x,h]=u.useState(""),[o,A]=u.useState({name:"",email:"",phone:"",address:"",city:"",zip:""});u.useEffect(()=>{const s=JSON.parse(localStorage.getItem("userInfo"));s&&A(s)},[]);const S=(s,a,i)=>{const t=[...d];i>t[s].stock_quantity?h("Quantity exceeds available stock."):(h(""),t[s][a]=i,b(t),w(`products[${s}].quantity`,i))},n=d.reduce((s,a)=>s+parseFloat(a.product.price)*a.quantity,0),_=parseFloat(p("paid_amount"))||0,q=Math.max(n-_,0),F=async s=>{try{const a={...s,products:d.map(t=>({product_name:t.product.productName,product_id:t.product.id,quantity:t.quantity,product_price:t.product.price,total_price:parseFloat(t.product.price)*t.quantity})),total_amount:n,pending_payment:q},i=await z.post("/OrderStore",a);console.log("Order placed successfully",i.data),v({name:"",email:"",phone:"",address:"",city:"",zip:"",paid_amount:""}),b(N),h(""),P.success("Order placed successfully")}catch(a){console.error("Error placing order",a),P.error("Error placing the order. Please try again.")}};let E=Object.values(p()).filter(s=>s!=="").length,I=d.some(s=>s.quantity>0)?1:0,g=Math.min((E+I)/(Object.keys(p()).length+1)*100,100);return e.jsx($,{children:e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Complete Your Order"}),e.jsx(R,{position:"top-right",autoClose:3e3}),e.jsx(k,{value:g,className:"mb-6"}),d.map((s,a)=>{var i,t;return e.jsxs(m,{className:"mb-4",children:[e.jsx(f,{children:"Order Summary"}),e.jsx(j,{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:s.product.productName}),e.jsx(l,{type:"number",value:s.quantity,...r(`products[${a}].quantity`,{valueAsNumber:!0,min:1,required:"Quantity is required"}),onChange:O=>S(a,"quantity",parseInt(O.target.value)||1),className:"w-20 text-center"}),x&&e.jsx("p",{className:"text-red-500 text-sm",children:x}),((t=(i=c.products)==null?void 0:i[a])==null?void 0:t.quantity)&&e.jsx("p",{className:"text-red-500 text-sm",children:c.products[a].quantity.message})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-semibold",children:"Price:"}),e.jsxs("span",{className:"text-xl font-bold",children:[e.jsx(y,{size:15})," ",s.product.price]})]})]})})]},a)}),e.jsx(m,{className:"mb-4",children:e.jsxs(L,{className:"flex flex-col space-y-2 font-bold",children:[e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:"Total Price:"}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(y,{size:15}),n.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:"Paid Amount:"}),e.jsx(l,{type:"number",min:"0",max:n,placeholder:"Enter Paid Amount",...r("paid_amount",{valueAsNumber:!0,required:"Paid amount is required",validate:s=>s>=0&&s<=n?!0:`Paid amount must be between 0 and the total amount (${n.toFixed(2)}).`}),className:"w-24 text-center"}),c.paid_amount&&e.jsx("p",{className:"text-red-500 text-sm",children:c.paid_amount.message})]}),e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:"Remaining Amount:"}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(y,{size:15}),q.toFixed(2)]})]})]})}),e.jsxs(m,{className:"mb-4",children:[e.jsx(f,{children:"Personal Details"}),e.jsxs(j,{className:"space-y-3",children:[e.jsx(l,{...r("name",{required:"Name is required"}),placeholder:"Full Name",defaultValue:o.name}),e.jsx(l,{...r("email",{required:"Email is required"}),placeholder:"Email Address",defaultValue:o.email}),e.jsx(l,{...r("phone",{required:"Phone number is required"}),placeholder:"Phone Number",defaultValue:o.phone})]})]}),e.jsxs(m,{className:"mb-4",children:[e.jsx(f,{children:"Shipping Address"}),e.jsxs(j,{className:"space-y-3",children:[e.jsx(l,{...r("address",{required:"Address is required"}),placeholder:"Street Address",defaultValue:o.address}),e.jsx(l,{...r("city",{required:"City is required"}),placeholder:"City",defaultValue:o.city}),e.jsx(l,{...r("zip",{required:"ZIP Code is required"}),placeholder:"ZIP Code",defaultValue:o.zip})]})]}),e.jsx(D,{className:"w-full mt-4",disabled:g<100||x,onClick:C(F),children:"Place Order"})]})})}export{X as default};
