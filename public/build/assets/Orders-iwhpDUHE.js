import{r as n,j as e,a as le}from"./app-BO-pgh5r.js";import{L as de}from"./Layout-DENH4sk5.js";import{c as H,a as u,I as N,B as m}from"./input-CrpobbBN.js";import{D,a as S,b as z,c as O,d as I,e as T}from"./dialog-DQyPmIf2.js";import{E as U,y}from"./index-Cw9JN88N.js";import{o as B}from"./orders-BiVkYTFE.js";import{I as g}from"./index-CMVX4kSo.js";import{C as ie}from"./circle-check-big-WhKus-YX.js";import"./index-B906Ms1P.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],oe=H("CircleX",ce);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],me=H("Clock",xe),$=n.forwardRef(({className:i,...r},l)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:l,className:u("w-full caption-bottom text-sm",i),...r})}));$.displayName="Table";const q=n.forwardRef(({className:i,...r},l)=>e.jsx("thead",{ref:l,className:u("[&_tr]:border-b",i),...r}));q.displayName="TableHeader";const Q=n.forwardRef(({className:i,...r},l)=>e.jsx("tbody",{ref:l,className:u("[&_tr:last-child]:border-0",i),...r}));Q.displayName="TableBody";const ge=n.forwardRef(({className:i,...r},l)=>e.jsx("tfoot",{ref:l,className:u("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",i),...r}));ge.displayName="TableFooter";const k=n.forwardRef(({className:i,...r},l)=>e.jsx("tr",{ref:l,className:u("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...r}));k.displayName="TableRow";const x=n.forwardRef(({className:i,...r},l)=>e.jsx("th",{ref:l,className:u("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",i),...r}));x.displayName="TableHead";const o=n.forwardRef(({className:i,...r},l)=>e.jsx("td",{ref:l,className:u("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",i),...r}));o.displayName="TableCell";const he=n.forwardRef(({className:i,...r},l)=>e.jsx("caption",{ref:l,className:u("mt-4 text-sm text-muted-foreground",i),...r}));he.displayName="TableCaption";const ue="https://event.nikatby.in/user/public/api/PayPendingPayment",ye={PendingPayment:async(i,r)=>le.post(ue,{order_id:i,payment_amount:r})};function pe(){const[i,r]=n.useState([]),[l,X]=n.useState(""),[G,J]=n.useState(!0),[F,K]=n.useState(null),[a,v]=n.useState(null),[V,p]=n.useState(!1),[Y,j]=n.useState(!1),[M,w]=n.useState(!1),[h,A]=n.useState(""),[C,W]=n.useState(""),[P,Z]=n.useState(""),[_,ee]=n.useState("All");n.useEffect(()=>{(async()=>{try{const c=(await B.getUserOrders()).orders.map(d=>({...d,products:typeof d.products=="string"?JSON.parse(d.products):d.products}));r(c||[])}catch(t){console.error("Error fetching orders:",t),K("Failed to fetch orders. Please try again later.")}finally{J(!1)}})()},[]);const se=s=>{const t=new Date(s);return t.setHours(23,59,59,999),t},b=i.filter(s=>{const t=!l||s.user_name.toLowerCase().includes(l.toLowerCase())||s.products.some(ne=>ne.product_name.toLowerCase().includes(l.toLowerCase())),c=_==="All"||s.status===_.toLowerCase(),d=s.delivered_date?new Date(s.delivered_date):null,re=(!C||d&&d>=new Date(C))&&(!P||d&&d<=se(P));return t&&c&&re}),f=s=>s?new Date(s).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Not Delivered",R=s=>{v(s),A(""),p(!0)},L=s=>{v(s),j(!0)},E=s=>{v(s),w(!0)},ae=async()=>{var s,t;if(!a||!h||Number(h)<=0){y.error("Please enter a valid payment amount.");return}try{await ye.PendingPayment(a.id,h),y.success("Payment successful!"),r(c=>c.map(d=>d.id===a.id?{...d,pending_payment:String(Number(d.pending_payment)-Number(h)),status:Number(d.pending_payment)-Number(h)<=0?"paid":d.status}:d)),p(!1)}catch(c){y.error(((t=(s=c.response)==null?void 0:s.data)==null?void 0:t.error)||"Payment failed. Please try again.")}},te=async()=>{var s,t;if(a)try{await B.cancelOrder(a.id),r(c=>c.map(d=>d.id===a.id?{...d,status:"canceled"}:d)),y.success("Order canceled successfully!"),j(!1)}catch(c){y.error(((t=(s=c.response)==null?void 0:s.data)==null?void 0:t.error)||"Failed to cancel the order.")}};return G?e.jsx("div",{className:"flex justify-center items-center min-h-screen text-gray-500",children:"Loading..."}):F?e.jsx("div",{className:"flex justify-center items-center min-h-screen text-red-500",children:F}):e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 bg-gradient-to-br from-gray-50 to-gray-200 dark:from-gray-800 dark:to-gray-900 min-h-screen",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6",children:"Your Orders"}),e.jsx("div",{className:"flex flex-col gap-4 mb-6 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsx(N,{placeholder:"Search by User Name or Product...",value:l,onChange:s=>X(s.target.value),className:"w-full sm:w-64 rounded-lg shadow-sm border-gray-300 dark:border-gray-600"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex flex-col w-full sm:w-40",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Start Date"}),e.jsx(N,{type:"date",value:C,onChange:s=>W(s.target.value),className:"rounded-lg shadow-sm border-gray-300 dark:border-gray-600"})]}),e.jsxs("div",{className:"flex flex-col w-full sm:w-40",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"End Date"}),e.jsx(N,{type:"date",value:P,onChange:s=>Z(s.target.value),className:"rounded-lg shadow-sm border-gray-300 dark:border-gray-600"})]}),e.jsxs("div",{className:"flex flex-col w-full sm:w-40",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status"}),e.jsxs("select",{value:_,onChange:s=>ee(s.target.value),className:"w-full border p-2 rounded-lg shadow-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Canceled",children:"Canceled"}),e.jsx("option",{value:"Paid",children:"Paid"})]})]})]})]})}),e.jsx("div",{className:"hidden lg:block bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:e.jsxs($,{children:[e.jsx(q,{children:e.jsxs(k,{className:"bg-gray-100 dark:bg-gray-700",children:[e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Order ID"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Client Name"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Delivered Date"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Products"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Quantity"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Address"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Total"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Pending"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Paid"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Status"}),e.jsx(x,{className:"font-semibold text-gray-700 dark:text-gray-200 text-right",children:"Actions"})]})}),e.jsx(Q,{children:b.length>0?b.map(s=>e.jsxs(k,{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(o,{className:"text-gray-800 dark:text-gray-200",children:s.id}),e.jsx(o,{className:"text-gray-800 dark:text-gray-200",children:s.user_name}),e.jsx(o,{className:"text-gray-600 dark:text-gray-400",children:f(s.delivered_date)}),e.jsxs(o,{className:"text-gray-800 dark:text-gray-200",children:[s.products.length," Products"]}),e.jsx(o,{className:"text-gray-800 dark:text-gray-200",children:s.products.reduce((t,c)=>t+c.quantity,0)}),e.jsxs(o,{className:"text-gray-600 dark:text-gray-400",children:[s.user_address,", ",s.user_city,", ",s.user_zip]}),e.jsx(o,{className:"text-gray-800 dark:text-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{size:14})," ",Number(s.total_amount).toFixed(2)]})}),e.jsx(o,{className:"text-gray-800 dark:text-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{size:14})," ",Number(s.pending_payment).toFixed(2)]})}),e.jsx(o,{className:"text-gray-800 dark:text-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{size:14})," ",Number(s.paid_payment).toFixed(2)]})}),e.jsx(o,{children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${s.status==="pending"?"bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-200":s.status==="canceled"?"bg-orange-100 text-orange-600 dark:bg-orange-900 dark:text-orange-200":"bg-green-100 text-green-600 dark:bg-green-900 dark:text-green-200"}`,children:[s.status==="pending"?e.jsx(me,{size:12}):s.status==="canceled"?e.jsx(oe,{size:12}):e.jsx(ie,{size:12}),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(m,{size:"sm",className:`px-3 ${s.status==="pending"?"bg-red-600 hover:bg-red-700":s.status==="canceled"?"bg-orange-500":"bg-green-600"} text-white`,onClick:()=>s.status==="pending"&&R(s),disabled:s.status!=="pending",children:s.status==="pending"?"Pay":s.status==="canceled"?"Canceled":"Paid"}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>E(s),children:e.jsx(U,{size:16})}),e.jsx(m,{size:"sm",className:"bg-yellow-600 hover:bg-yellow-700 text-white",onClick:()=>L(s),disabled:s.status==="canceled"||s.status==="paid",children:"Cancel"})]})})]},s.id)):e.jsx(k,{children:e.jsx(o,{colSpan:11,className:"text-center py-6 text-gray-500 dark:text-gray-400",children:"No orders found."})})})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:hidden gap-4",children:b.length>0?b.map(s=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-lg text-gray-800 dark:text-gray-100",children:["Order #",s.id]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Client:"})," ",s.user_name]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Delivered:"})," ",f(s.delivered_date)]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Products:"})," ",s.products.length]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Quantity:"})," ",s.products.reduce((t,c)=>t+c.quantity,0)]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Total:"})," ₹",Number(s.total_amount).toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Pending:"})," ₹",Number(s.pending_payment).toFixed(2)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`font-semibold ${s.status==="pending"?"text-red-600":s.status==="canceled"?"text-orange-600":"text-green-600"}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2 flex-wrap",children:[e.jsx(m,{size:"sm",className:`flex-1 ${s.status==="pending"?"bg-red-600 hover:bg-red-700":s.status==="canceled"?"bg-orange-500":"bg-green-600"} text-white`,onClick:()=>s.status==="pending"&&R(s),disabled:s.status!=="pending",children:s.status==="pending"?"Pay":s.status==="canceled"?"Canceled":"Paid"}),e.jsx(m,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>E(s),children:e.jsx(U,{size:16})}),e.jsx(m,{size:"sm",className:"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white",onClick:()=>L(s),disabled:s.status==="canceled"||s.status==="paid",children:"Cancel"})]})]},s.id)):e.jsx("div",{className:"col-span-full text-center text-gray-500 dark:text-gray-400 py-6",children:"No orders found."})}),e.jsx(D,{open:V,onOpenChange:p,children:e.jsxs(S,{className:"sm:max-w-md bg-white dark:bg-gray-800",children:[e.jsxs(z,{children:[e.jsx(O,{className:"text-gray-800 dark:text-gray-100",children:"Confirm Payment"}),e.jsxs(I,{className:"text-gray-600 dark:text-gray-400",children:["Pay the pending amount for Order #",a==null?void 0:a.id,"."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Pending Amount"}),e.jsxs("p",{className:"flex items-center gap-1 text-gray-800 dark:text-gray-200",children:[e.jsx(g,{size:15})," ",Number(a==null?void 0:a.pending_payment).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enter Amount"}),e.jsx(N,{type:"number",value:h,onChange:s=>{const t=Number(s.target.value);t>=0&&t<=Number(a==null?void 0:a.pending_payment)?A(s.target.value):y.error("Amount must be between 0 and pending payment.")},className:"mt-1 border-gray-300 dark:border-gray-600",min:"0",max:a==null?void 0:a.pending_payment,step:"0.01"})]})]}),e.jsxs(T,{className:"mt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(m,{onClick:ae,className:"bg-blue-600 hover:bg-blue-700",disabled:!h||Number(h)<=0,children:"Confirm Payment"})]})]})}),e.jsx(D,{open:Y,onOpenChange:j,children:e.jsxs(S,{className:"sm:max-w-md bg-white dark:bg-gray-800",children:[e.jsxs(z,{children:[e.jsx(O,{className:"text-gray-800 dark:text-gray-100",children:"Confirm Cancellation"}),e.jsxs(I,{className:"text-gray-600 dark:text-gray-400",children:["Are you sure you want to cancel Order #",a==null?void 0:a.id,"? This action cannot be undone."]})]}),e.jsxs(T,{className:"mt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>j(!1),children:"Keep Order"}),e.jsx(m,{onClick:te,className:"bg-red-600 hover:bg-red-700",children:"Cancel Order"})]})]})}),e.jsx(D,{open:M,onOpenChange:w,children:e.jsxs(S,{className:"sm:max-w-lg bg-white dark:bg-gray-800",children:[e.jsx(z,{children:e.jsxs(O,{className:"text-gray-800 dark:text-gray-100",children:["Order Details - #",a==null?void 0:a.id]})}),a&&e.jsxs("div",{className:"space-y-3 text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Created:"})," ",f(a.created_at)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",a.user_phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Delivered:"})," ",f(a.delivered_date)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Address:"})," ",a.user_address,", ",a.user_city,", ",a.user_zip]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total Amount:"})," ",e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(g,{size:15})," ",Number(a.total_amount).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Pending:"})," ",e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(g,{size:15})," ",Number(a.pending_payment).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Paid:"})," ",e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(g,{size:15})," ",Number(a.paid_payment).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`font-semibold ${a.status==="pending"?"text-red-600":a.status==="canceled"?"text-orange-600":"text-green-600"}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Products:"}),e.jsx("ul",{className:"list-disc pl-5 mt-2 space-y-1",children:a.products.map((s,t)=>e.jsxs("li",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-2",children:[e.jsxs("span",{className:"flex items-center",children:[s.product_name," - ",s.quantity," x ",e.jsx(g,{size:14})," ",Number(s.product_price).toFixed(2)," ="," ",e.jsx(g,{size:14})," ",Number(s.total_price).toFixed(2)]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:["(From: ",s.From,")"]})]},t))})]})]}),e.jsx(T,{className:"mt-4",children:e.jsx(m,{onClick:()=>w(!1),className:"bg-gray-600 hover:bg-gray-700",children:"Close"})})]})})]})}function _e(){return e.jsx(de,{children:e.jsx(pe,{})})}export{_e as default};
